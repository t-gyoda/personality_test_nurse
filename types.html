<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>16タイプ一覧｜看護師 16パーソナリティ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./config.js"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-4xl mx-auto p-6">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-bold">16タイプ一覧</h1>
      <a href="./index.html" class="text-sm underline">トップへ</a>
    </div>

    <div class="bg-white rounded-2xl shadow p-5 mb-5">
      <div class="text-gray-600 text-sm mb-2">
        タイプ名・説明文から検索できます（例：「放任」「共感」「ロジカル」など）
      </div>
      <input id="q" class="w-full border rounded-xl p-3"
             placeholder="検索（タイプ名 / 説明文）" />
      <div id="count" class="text-sm text-gray-500 mt-2"></div>
    </div>

    <div id="loading" class="text-gray-600">読み込み中…</div>
    <div id="grid" class="hidden grid gap-4 md:grid-cols-2"></div>
  </div>

<script>
function GAS_URL(){ return window.APP_CONFIG.GAS_URL; }

function esc(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

async function fetchTypes(){
  const r = await fetch(`${GAS_URL()}?path=types`);
  const j = await r.json();
  if(!j.ok) throw new Error(j.error || 'types取得失敗');
  return j.types || [];
}

function cardHtml(t){
  const links = (t.links || [])
    .map(l => `<a class="underline text-sm" href="${esc(l.url)}" target="_blank" rel="noreferrer">${esc(l.label)}</a>`)
    .join(' <span class="text-gray-300">|</span> ');

  return `
    <div class="bg-white rounded-2xl shadow p-5">
      <div class="text-sm text-gray-500">16タイプ</div>
      <div class="text-xl font-bold mt-1">${esc(t.typeCode)}${t.typeName ? ` <span class="text-base font-semibold text-gray-700">（${esc(t.typeName)}）</span>` : ''}</div>

      ${t.summary ? `
      <div class="mt-3">
        <div class="font-semibold">概要</div>
        <div class="text-gray-700 whitespace-pre-wrap mt-1">${esc(t.summary)}</div>
      </div>` : ''}

      ${t.tips ? `
      <div class="mt-3">
        <div class="font-semibold">ヒント</div>
        <div class="text-gray-700 whitespace-pre-wrap mt-1">${esc(t.tips)}</div>
      </div>` : ''}

      ${links ? `
      <div class="mt-3">
        <div class="font-semibold">リンク</div>
        <div class="mt-1 flex flex-wrap gap-2">${links}</div>
      </div>` : ''}
    </div>
  `;
}

function toSearchText(t){
  return [
    t.typeCode, t.typeName, t.summary, t.details, t.tips,
    ...(t.links || []).map(x => `${x.label} ${x.url}`)
  ].filter(Boolean).join(' ').toLowerCase();
}

(async function main(){
  try{
    const types = await fetchTypes();
    const data = types.map(t => ({ t, s: toSearchText(t) }));

    const loading = document.getElementById('loading');
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const count = document.getElementById('count');

    function render(){
      const kw = q.value.trim().toLowerCase();
      const filtered = kw ? data.filter(x => x.s.includes(kw)) : data;

      grid.innerHTML = filtered.map(x => cardHtml(x.t)).join('');
      count.textContent = `${filtered.length} / ${data.length} 件`;
    }

    loading.classList.add('hidden');
    grid.classList.remove('hidden');

    q.addEventListener('input', render);
    render();

  }catch(e){
    document.getElementById('loading').textContent = 'エラー：' + e.message;
  }
})();
</script>
</body>
</html>
